BUILD_PF=false
BUILD_HP=false
BUILD_PG=false
BUILD_NF=false

# Parse arguments and set build flags
if [ $# -eq 0 ] || [[ " $* " =~ " --all " ]]; then
  BUILD_PF=true
  BUILD_HP=true
  BUILD_PG=true
  BUILD_NF=true
else
  for arg in "$@"; do
    case "$arg" in
      --pg) BUILD_PG=true ;;
      --hp) BUILD_HP=true ;;
      --pf) BUILD_PF=true ;;
      --pf) BUILD_NF=true ;;
    esac
  done
fi

# Function to robustly replace import target in src/index.jsx
replace_import_target() {
  local new_target="$1"
  # Replace any of the three possible targets with the new one
  sed -i '' -E "s#(homepage|portfolio|playground)#$new_target#g" src/index.jsx
}

if [ "$BUILD_PF" = true ]; then
  echo "=== Building portfolio and copying to root directory ==="
  replace_import_target "portfolio"
  npm run build
  cp ./pages/dist/index.bundle.js ./pages/dist/index.bundle.js.map ./pages/portfolio
fi

if [ "$BUILD_HP" = true ]; then
  echo "=== Building homepage and copying to ./homepage ==="
  replace_import_target "homepage"
  npm run build
  cp ./pages/dist/index.bundle.js ./pages/dist/index.bundle.js.map ./pages/homepage
fi

if [ "$BUILD_PG" = true ]; then
  echo "=== Building playground and copying to ./playground ==="
  replace_import_target "playground"
  npm run build
  cp ./pages/dist/index.bundle.js ./pages/dist/index.bundle.js.map ./pages/playground
fi

if [ "$BUILD_NF" = true ]; then
  echo "=== Building 404 and copying to ./notfound ==="
  replace_import_target "notfound"
  npm run build
  cp ./pages/dist/index.bundle.js ./pages/dist/index.bundle.js.map ./pages/notfound
fi

echo "=== Committing and pushing changes to Git ==="
git add .
git commit -m "Automatic page builds"
git push